<% include ../templates/header %>

<div id="header">
    <h1>Seznam úkolů</h1>
    <p class="bigtext">Přehledný seznam dokončených a nedokončených úkolů.</p>
</div>
<div id="body">
    <form id="addTask">
        <input type="text" id="task"/>
        <input type="submit" />
    </form>

    <table id="list" style="width:100%">
        <% for (let i = 0; i < polozky.length; i++) { %>
            <tr><td class="polozka"><%= polozky[i].id %> - <%= polozky[i].task %></td></tr>
        <% } %>
    </table>

</div>

<script type="text/javascript">
    document.getElementById("addTask").addEventListener('submit', e => {
        e.preventDefault();
        let task = document.getElementById("task").value,
            xhr = new XMLHttpRequest();

        xhr.open('POST', '/list/add');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onload = function() {
            if (xhr.status === 200) {
                let response = JSON.parse(xhr.responseText);
                let parent = document.createElement("tr");
                let node = document.createElement("td");
                let textnode = document.createTextNode(response.id + " - " + response.task);
                node.classList.add('polozka');
                node.appendChild(textnode);
                parent.appendChild(node);
                document.getElementById("list").getElementsByTagName("tbody")[0].appendChild(parent);
            } else if (xhr.status !== 200) {
                alert('Požadavek selhal. Chyba ' + xhr.status);
            }
        };
        xhr.send(encodeURI('task=' + task));
    });
</script>


<% include ../templates/footer %>